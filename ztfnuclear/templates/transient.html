{% extends 'base.html' %}

{% block title %}{{ transient.ztfid }}{% endblock %}

{% block content %}

<div class="sticky-top my-2 py-0" style="background: linear-gradient(to top, rgba(254, 254, 254 ,0.5), rgba(254, 254, 254 , 1 ))">
    <div class="row">
        <div class="col-auto me-auto">
            {% if transient.tns_name != None %}
            <h1> {{ transient.ztfid }} ({{ transient.tns_name }}) </h1>
            {% else %}
            <h1> {{ transient.ztfid }} </h1>
            {% endif %} 
        </div>

        <div class="col-auto my-2">
            <form method="post" action="/rate/{{ transient.ztfid }}" >

                <div class="btn-group" role="group" aria-label="Basic example">
                    {% if transient.get_rating(current_user.username) == 3 %}
                        <button type="submit" class="btn btn-success" value="{{ request.url }}&rating=3&user={{ current_user.username }}" name="rating">
                            Interesting
                        </button>
                    {% else %}
                        <button type="submit" class="btn btn-outline-success" value="{{ request.url }}&rating=3&user={{ current_user.username }}" name="rating">
                            Interesting
                        </button>
                    {% endif %}
                    {% if transient.get_rating(current_user.username) == 2 %}
                        <button type="submit" class="btn btn-warning" value="{{ request.url }}&rating=2&user={{ current_user.username }}" name="rating">
                            Maybe
                        </button>
                    {% else %}
                        <button type="submit" class="btn btn-outline-warning" value="{{ request.url }}&rating=2&user={{ current_user.username }}" name="rating">
                            Maybe
                        </button>
                    {% endif %}
                    {% if transient.get_rating(current_user.username) == 1 %}
                        <button type="submit" class="btn btn-danger" value="{{ request.url }}&rating=1&user={{ current_user.username }}" name="rating">
                            Boring
                        </button>
                    {% else %}
                        <button type="submit" class="btn btn-outline-danger" value="{{ request.url }}&rating=1&user={{ current_user.username }}" name="rating">
                            Boring
                        </button>
                    {% endif %}
                </div>
            </form>
        </div>

        <div class="col-auto my-2">
            <nav aria-label="Page navigation">
              <ul class="pagination">
                {% if flaring == True %}
                <li class="page-item"><a class="page-link" href="/flaring/{{ previous_transient }}">Previous</a></li>
                {% else %}
                <li class="page-item"><a class="page-link" href="/transients/{{ previous_transient }}">Previous</a></li>
                {% endif %}
                {% if flaring == True %}
                <li class="page-item"><a class="page-link" href="/flaring/{{ next_transient }}">Next</a></li>
                {% else %}
                <li class="page-item"><a class="page-link" href="/transients/{{ next_transient }}">
                Next</a></li>
                {% endif %}
              </ul>
            </nav>
        </div>


        <div class="col-auto my-2">
          <a class="btn btn-outline-dark" href="http://skipper.caltech.edu:8080/cgi-bin/growth/view_source.cgi?name={{ transient.ztfid }}" target="_blank">
             Growth
          </a>
          <a class="btn btn-outline-dark" href="https://fritz.science/source/{{ transient.ztfid }}" target="_blank">
             Fritz
          </a>
        {% if transient.tns_name != None %}
          <a class="btn btn-outline-dark" href="https://www.wis-tns.org/object/{{ transient.tns_name[2:] }}" target="_blank">
             TNS
          </a>
        {% else %}
        <button type="button" class="btn btn-outline-dark" disabled>TNS</button>
        {% endif %}
        </div>
    </div>
</div>


<div class="container">
  <div class="row">
    <div class="col">
        <div class="row">
            {% if transient.z != None %}
                    <h5 style="color:#787878;">
                      z: {{ "{:,.4f}".format(transient.z) }} (dist: {{ "{:,.4f}".format(transient.z_dist) }} arcsec) 
                    </h5>
            {% else %}
                    <h5 style="color:#C9C9C9;">
                      z: --- 
                    </h5>
            {% endif %}
        </div>
        <div class="row">
            {% if transient.get_crossmatch_info() != None %}
                    <h5 style="color:#787878;">
                      Crossmatch: {{ transient.get_crossmatch_info() }}
                    </h5>
            {% else %}
                    <h5 style="color:#C9C9C9;">
                      Crossmatch: --- 
                    </h5>
            {% endif %}
        </div>
        <div class="row">
            {% if 'fritz_class' in transient.meta.keys() %}
                    <h5 style="color:#787878;">
                      Fritz: {{ transient.meta['fritz_class'] }}
                    </h5>
            {% else %}
                    <h5 style="color:#C9C9C9;">
                      Fritz: ---
                    </h5>
            {% endif %}
        </div>
        <div class="row">
            {% if transient.tde_res != None %}
                    <h5 style="color:#787878;">
                      TDE fit red_chisq: {{ "{:,.3f}".format(transient.tde_res) }}
                    </h5>
            {% else %}
                    <h5 style="color:#C9C9C9;">
                      TDE fit red_chisq: ---
                    </h5>
            {% endif %}
        </div>
        <div class="row">
            {% if transient.salt_res != None %}
                    <h5 style="color:#787878;">
                      SALT fit red_chisq: {{ "{:,.3f}".format(transient.salt_res) }} 
                    </h5>
            {% else %}
                    <h5 style="color:#C9C9C9;">
                      SALT fit red_chisq: --- 
                    </h5>
            {% endif %}
        </div>
    </div>
    <div class="col">
        <div class="container">
            <div class="be-comment-block">
                <h5 class="comments-title">Comments ({{ comment_count }})</h5>
                    <div class="be-comment">
                        <div class="be-comment-content">
                            {% for comment in comments %}
                            {% if comment != None %}
                                <p class="be-comment-text">
                                    <b>{{ comment['username'] }}</b>: {{ comment['comment'] }}
                                </p>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
            </div>
        </div>
        <form class="form-group" method="post" role="form" action="/comment/{{ transient.ztfid }}">
            <div class="row">
                <div class="col">                                 
                    <input class="form-control form-control-sm" type="text" placeholder="Enter your comment here" name="comment">
                </div>
                <div class="col">
                    <button type="submit" class="btn btn-outline-dark btn-sm" value="{{ request.url }}" name="origin">Submit comment</button>
                </div>
            </div>
        </form>
</div>



  <div class="row justify-content-md-center">
    <img src='data:image/png;base64,{{ lcplot }}' />
  </div">

  {% if plot_irsa == True %}
  <br>
  <div class="row justify-content-md-center">
    <img src='data:image/png;base64,{{ lcplot_irsa }}' />
  </div">
  {% endif %}

{% endblock %}
